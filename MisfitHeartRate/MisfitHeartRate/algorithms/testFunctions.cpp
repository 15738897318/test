//
//  testFunctions.cpp
//  MisfitHeartRate
//
//  Created by Bao Nguyen on 7/15/14.
//  Copyright (c) 2014 misfit. All rights reserved.
//

#include "testFunctions.h"


namespace MHR {
    void testMathFunctions()
    {
//        int sizeArr[] = {30, 40, 100};
//        Mat img = Mat(3, sizeArr, CV_64F, CvScalar(0));
//        double v = 0, delta = 1;
//        for(int i=0; i<100; ++i){
//            if(v==10){
//                delta=-1;
//            }else if(v==-10){
//                delta=1;
//            }
//            v+=delta;
//            for(int x=0; x<30; ++x) for(int y=0; y<40; ++y) img.at<double>(x,y,i)=v;
//        }
//        Mat debugImg;
//        vector<double> ans = frames2signal(img, "mode-balance", 30, 0, debugImg);
//        for(int i=0; i<(int) ans.size(); ++i) cout<<ans[i]<<' '; cout<<endl;


//        vector<double> arr;
//        for(int i=0; i<100; ++i){
//        arr.push_back(1.0*(rand()%10000)/(rand()%100));
//        }
//        cout<<"[";
//        for(int i=0; i<100-1;++i) cout<<arr[i]<<", "; cout<<arr[99]<<"]"<<endl;
//        arr=low_pass_filter(arr);
//        cout<<"[";
//        for(int i=0; i<100-1;++i) cout<<arr[i]<<", "; cout<<arr[99]<<"]"<<endl;


//        vector<double>seg1{1, 7, 3, 89, 5, 16, 5};
//        vector<double> seg2{0.1, 1.38, 0.76};
//        vector<double> ans = conv(seg1,seg2);
//        cout<<(int)ans.size()<<endl;
//        for(int i=0; i<(int)ans.size(); ++i) cout<<ans[i]<<' '; cout<<endl;


//        vector<double> arr;
//        srand(time(NULL));
//        for(int i=1; i<=100; ++i) arr.push_back(i);
//        for(int i=1; i<=100; ++i){
//        double per=(rand()%10001)/100.0;
//        cout<<i<<' '<<per<<' '<<prctile(arr, per)<<' '<<invprctile(arr, prctile(arr,per))<<endl;
//        }


//        invprctile checking
//        vector<double> arr {5,1,3,2.2,3.1,5.6,10};
//        cout<<invprctile(arr, 10)<<endl;
//        cout<<invprctile(arr, 0)<<endl;
//        cout<<invprctile(arr, 1)<<endl;


//        srand(time(NULL));
//        vector<double> data {0,2,9,2,5,8,7,3,1,9,4,3,5,8,10,0,1,2,9,5,10};
//        vector<int> counts;
//        vector<double> centers;
//        hist(data, 10, counts, centers);
//        cout<<counts.size()<<endl;
//        for(int i=0; i<(int) counts.size(); ++i) cout<<centers[i]<<' '<<counts[i]<<endl;


//        vector<double> segment;
//        for(double x=0; x<=100; x+=0.01)
//            segment.push_back(sin(x*acos(-1)));
//        printf("input: \n");
//        for (int i = 0; i < (int)segment.size(); ++i)
//            printf("%lf\n", segment[i]);
//
//        vector<double> strengths;
//        vector<int> locs;
//        findpeaks(segment, 300, 0, strengths, locs);
//        printf("%d\n",(int)strengths.size());
//
//        for(int i=0; i<strengths.size(); ++i)
//            printf("%lf %d\n",strengths[i], locs[i]);
    }

    
    void test_function(const vector<int> &src, vector<int> &dst) {
        if (&src == &dst)
            printf("&src == &dst\n");
        dst.clear();
        for (int i = 0; i < (int)src.size(); ++i)
            dst.push_back(src[i]*src[i]);
    }
    
    
    void test_openCV()
    {
        printf("test_openCV()\n");
        int n = 100;
//        int m = 200;
//        int array_size[] = {100, 200, 10};
//        Mat a = Mat(3, array_size, CV_64FC3, cv::Scalar(0));
//        Mat b = Mat(3, array_size, CV_32FC3, cv::Scalar(0));
//        Mat a = Mat::ones(n, m, CV_64FC3);
//        Mat b = Mat::ones(n, m, CV_32FC3);
//        a.convertTo(b, CV_32FC3);
//        b.convertTo(b, CV_64FC3);
        
        vector<int> a;
        vector<int> b;
        for (int i = 0; i < n; ++i)
            a.push_back(i);
        test_function(a, a);
        for (int i = 0; i < (int)a.size(); ++i)
            printf("%d, ", a[i]);
//        test_function(a, b);
//        for (int i = 0; i < (int)b.size(); ++i)
//            printf("%d, ", b[i]);
        printf("\n");
    }
    
    
    void test_findpeak()
    {
        int n = 681;
        double a[] = {0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 635.587431, 636.975222, 637.954756, 638.281334, 637.692496, 635.999492, 633.157677, 629.326174, 624.865400, 620.305001, 616.260073, 613.400868, 612.381094, 613.868142, 618.162778, 625.194844, 634.485988, 645.155563, 656.041387, 665.877717, 673.491654, 677.977586, 678.808946, 675.844548, 669.281039, 659.570121, 647.325643, 633.297123, 618.347516, 603.510096, 590.318310, 579.893707, 573.537648, 572.655571, 578.512140, 591.871328, 612.621470, 639.503825, 670.071385, 700.921886, 728.195732, 748.188281, 757.985091, 755.969807, 742.136050, 717.651102, 685.502876, 649.475773, 613.531272, 581.322285, 555.837084, 539.215688, 532.678861, 536.503804, 550.011466, 571.607199, 598.908482, 628.977566, 658.700306, 685.117267, 705.815736, 719.196472, 724.632330, 722.133484, 712.279193, 696.085139, 674.869062, 650.265805, 624.318361, 599.450888, 578.327722, 563.510233, 556.966530, 559.576362, 570.816329, 588.760054, 610.396008, 632.127987, 650.638180, 663.382874, 668.934191, 667.139926, 659.052477, 646.618814, 632.398062, 619.186588, 609.639404, 605.905509, 609.249282, 619.707841, 635.874359, 654.906248, 672.882334, 685.562896, 689.241297, 682.119274, 664.481792, 638.690228, 608.732446, 579.318299, 554.853204, 538.598743, 532.142506, 535.347449, 546.724346, 564.015702, 584.824068, 607.048919, 629.075603, 649.895972, 668.449788, 683.753408, 694.869717, 700.978794, 701.522499, 696.370168, 685.902936, 671.014917, 653.041161, 633.586509, 614.422479, 597.323646, 583.961911, 575.741399, 573.511937, 577.243560, 585.825771, 597.363393, 609.239769, 618.646212, 623.196901, 621.524529, 613.732800, 601.513232, 587.932590, 576.754727, 571.621587, 575.180072, 588.416113, 610.359148, 638.250865, 668.135075, 695.329984, 715.400777, 724.866323, 721.715683, 705.697343, 678.305712, 642.555933, 602.539148, 562.890810, 528.164745, 502.190733, 487.544653, 485.220269, 494.611913, 513.769835, 539.843481, 569.950648, 601.176450, 630.987369, 657.359461, 678.760610, 694.032250, 702.297727, 702.967641, 695.777895, 680.978559, 659.471468, 632.852906, 603.283319, 573.218235, 545.137894, 520.765360, 501.319602, 487.437965, 479.256136, 476.574959, 479.020584, 486.182207, 497.655908, 513.090565, 532.126168, 554.344648, 579.225878, 606.072108, 633.951708, 661.625335, 687.631812, 710.357401, 728.309493, 739.909909, 743.717842, 738.600926, 723.884092, 699.480927, 666.029876, 625.030320, 578.957253, 531.271465, 486.360266, 449.252306, 425.087721, 418.423451, 432.345249, 467.406671, 521.369847, 588.987839, 662.437556, 732.294587, 788.944280, 824.178441, 832.647478, 812.847705, 767.439863, 702.788912, 627.830789, 552.621418, 486.696051, 437.715856, 410.539974, 406.859877, 425.254278, 462.260777, 513.213362, 573.087084, 637.038727, 700.494953, 758.897093, 807.369278, 840.612068, 853.286917, 840.826944, 800.690671, 733.625366, 644.567291, 542.772319, 441.317173, 354.928892, 297.526696, 279.496050, 305.440563, 373.017966, 473.242932, 592.058294, 712.843699, 819.252329, 897.827041, 939.923502, 942.669184, 908.928102, 846.496470, 766.598952, 682.044215, 605.012634, 545.905247, 511.621692, 504.627258, 522.628576, 559.035056, 604.199537, 647.315233, 678.567973, 691.114249, 682.458700, 654.905710, 614.958294, 571.843626, 535.610502, 515.553002, 518.097240, 546.110943, 598.712198, 671.587275, 757.718535, 848.253129, 933.439134, 1003.520549, 1049.546523, 1064.149081, 1042.228315, 981.545043, 883.202170, 751.974615, 751.974615, 230.548863, 229.481564, 227.534552, 225.110271, 222.678032, 220.666836, 219.415018, 219.146794, 220.004818, 222.064831, 225.352188, 229.815160, 235.299702, 241.522132, 248.059047, 254.373172, 259.918898, 264.011132, 266.133706, 266.056463, 263.843278, 259.747906, 254.075441, 247.017128, 238.629185, 228.867087, 217.754583, 205.456367, 192.724660, 180.724247, 170.763279, 164.053080, 161.545803, 163.767199, 170.727611, 181.912367, 196.381428, 212.927345, 230.259998, 247.145590, 262.507887, 275.459194, 285.481401, 292.083139, 294.955930, 294.144062, 290.084081, 283.441916, 274.948756, 265.266826, 254.873090, 244.066516, 232.983158, 221.707087, 210.444593, 199.644907, 190.051307, 182.606590, 178.322410, 178.060159, 182.299780, 190.973961, 203.419200, 218.448782, 234.494326, 249.870893, 262.712800, 271.535380, 275.405508, 274.003054, 267.633785, 257.181613, 243.949476, 229.434465, 215.100325, 202.162282, 191.440543, 183.280485, 177.576682, 173.888719, 171.596993, 170.428289, 170.364815, 171.719076, 175.100811, 181.229460, 190.597100, 203.139246, 218.049466, 233.801065, 248.441447, 260.145489, 267.559676, 270.066029, 267.993812, 262.568686, 255.664862, 249.360974, 245.379664, 244.569295, 246.635594, 250.159969, 252.962454, 252.666968, 247.337809, 235.972571, 218.645524, 196.671193, 172.523799, 149.357101, 130.427799, 118.475673, 115.219005, 121.158330, 135.618733, 156.970542, 182.998861, 211.263125, 239.379547, 265.129410, 286.503490, 301.699870, 309.143702, 307.560729, 296.223637, 275.209132, 245.641466, 209.844808, 171.252070, 134.076821, 102.939894, 82.086193, 74.634152, 81.935093, 103.294889, 135.973139, 175.570774, 216.720869, 253.981788, 282.717208, 299.816876, 304.085585, 296.230997, 278.500075, 254.112996, 226.438874, 198.506140, 172.690231, 150.665126, 133.524266, 122.044983, 116.911298, 118.748932, 128.020721, 144.774177, 168.367447, 197.062352, 228.035515, 257.538472, 281.315720, 295.232324, 296.017749, 281.953816, 253.401729, 213.000137, 165.481534, 117.072149, 74.615510, 44.408498, 31.072525, 36.625747, 60.213901, 98.136172, 144.491489, 192.318006, 234.894092, 266.910496, 285.325793, 289.666431, 281.772014, 265.100938, 243.804818, 221.799960, 202.110313, 186.517653, 175.548802, 168.705055, 164.917735, 163.043792, 162.201429, 161.997746, 162.643356, 164.862404, 169.660192, 177.977260, 190.104266, 205.440350, 222.518984, 239.240471, 253.276019, 262.524117, 265.572843, 262.023103, 252.647134, 239.332748, 224.760857, 211.830757, 203.017444, 199.790226, 202.266779, 209.394295, 219.228590, 229.332508, 237.262498, 241.062595, 239.683692, 233.281284, 223.257028, 211.954410, 201.879633, 195.353383, 193.825424, 197.431276, 204.957069, 214.173529, 222.427102, 227.327893, 227.372845, 222.344739, 213.399362, 202.837813, 193.576282, 188.438972, 189.550199, 198.213715, 214.451685, 237.192393, 264.636862, 294.549189, 324.452938, 351.792620, 374.081418, 389.040967, 394.803956, 390.094206, 374.478021, 348.581597, 314.244193, 274.468677, 233.161669, 194.743163, 163.575657, 143.314406, 136.377016, 143.561330, 163.958401, 195.073174, 233.134101, 273.152532, 309.760529, 338.001420, 354.171891, 356.504501, 345.566146, 324.206698, 297.076351, 269.767428, 247.790524, 235.549744, 235.578635, 248.089883, 270.940580, 300.047856, 330.585871, 357.769611, 377.619672, 387.389445, 385.737382, 372.555833, 348.690929, 315.589464, 275.011721, 275.011721, 53.645343, 55.406226, 55.617491, 54.240765, 51.166461, 46.290028, 39.651140, 39.651140, 17.838432, 11.405116, 5.829011, 1.787183, 0.000000, 1.130744, 5.584315, 13.436819, 24.334608, 37.545305, 51.987822, 66.451039, 79.749322, 90.878876, 99.075102};
        vector<double> segments, max_peak_strengths;
        vector<int> max_peak_locs;
        for (int i = 0; i < n; ++i) segments.push_back(a[i]);
        findpeaks(segments, 60.0*30.0/200.0, 0, max_peak_strengths, max_peak_locs);
        int m = (int)max_peak_locs.size();
        printf("max_peak_locs.size() = %d\n", m);
    }
}